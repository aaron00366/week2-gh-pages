<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="./all.css">
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>

</head>
    <div id="app">
        <div class="container">
          <div class="row justify-content-center">
            <h1 class="h3 mb-3 font-weight-normal">
              請先登入
            </h1>
            <div class="col-8">
              <form id="form" class="form-signin">
                <div class="form-floating mb-3">
                  <input type="email" class="form-control" id="username" v-model="user.username"
                    placeholder="name@example.com" required autofocus>
                  <label for="username">Email address</label>
                </div>
                <div class="form-floating">
                  <input type="password" class="form-control" id="password" v-model="user.password"
                    placeholder="Password" required>
                  <label for="password">Password</label>
                </div>
                <button id="loginBtn" class="btn btn-lg btn-primary w-100 mt-3" type="button"  v-on:click="login">
                  登入
                </button>
              </form>
            </div>
          </div>
          <p class="mt-5 mb-3 text-muted">
            &copy; 2021~∞ - 六角學院
          </p>
        </div>
      </div>
    
      <!-- <script>
    const url = 'https://vue3-course-api.hexschool.io/v2/';
    const path = 'aaronshih04263test';
    
    const loginBtn = document.querySelector('#loginBtn')
    const emailInput = document.querySelector('#username');
    const passwordInput = document.querySelector('#password');
    
    loginBtn.addEventListener('click',()=>{
      const username = emailInput.value;
      const password = passwordInput.value;
      //console.log(username, password)
      
      const user = {
        username,
        password
      }
      console.log(user)
      axios.post(`${url}/admin/signin`,user)
      .then((res)=>{
        console.log(res)
        const {token,expired}=res.data;
        console.log(token,expired)
        document.cookie = `aarontoken=${token}; expires=${expired}`;
        window.location = 'products.html';
        axios.defaults.headers.common['Authorization'] = token;//登入成功時

      })
      .catch((err)=>{
        console.log(err)
      })
    })
        //從coolie 取出的
        //當cookie 有儲存時，就可以取出來
        let token = document.cookie.replace(/(?:(?:^|.*;\s*)aarontoken\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        // console.log(token);
        axios.defaults.headers.common['Authorization'] = token;//coolie有儲存時
        window.location = 'products.html';
      </script> -->

      
      <script type="module">
          import { createApp } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
          const app = {
            data() {
              return {
                user : {
                   username:'',
                   password:'',
                 },
              }
            },
            methods: {
              login(){
                const url = "https://vue3-course-api.hexschool.io/v2/"
                //console.log(url)
                axios.post(`${url}admin/signin`,this.user) 
                .then((res)=>{
                  console.log(res)
                  console.log(res.data.token)
                  //const { token,expired} = res.data;
                  const {expired,token} = res.data;
                  document.cookie = `aarontoken=${token}; expires=${expired}`;
                  window.location = 'products.html';
                })
                .catch((error)=>{
                  console.log(error)
                })
              }
            }
          }
          createApp(app)
          .mount('#app')
        </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.9.1/axios.min.js'
      integrity='sha512-Xk3wWei2TGrsh9kDSBKUMIjw/86sLUvhtnv9f7fOuIwhhiUTKz8szkWkzHthrM5Bb3Bu9idSzkxOrkzhcneuiw=='
      crossorigin='anonymous'></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"
      integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
      integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc"
      crossorigin="anonymous">
    </script>      
    
</body>
</html>